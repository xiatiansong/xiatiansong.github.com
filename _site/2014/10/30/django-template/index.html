<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Django中的模板 - 天松的个人博客</title>
  <meta name="description" content="主要介绍 Django 中模板相关的知识点，包括模板标签、模板过滤器，以及如何在试图中使用模板等等。">
  <meta name="keywords" content="java, hadoop, hive, hbase, spark, linux, scala, python, mysql">
  <meta name="author" content="天松">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="360-site-verification" content="9b7a87a1d52051c96644f0a9b8b79898" />
  <meta name="sogou_site_verification" content="ofwXWFdthV"/>

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" >

  <link rel="canonical" href="http://blog.xiatiansong.com/2014/10/30/django-template">
  <link rel="stylesheet" href="/static/css/bootstrap.min.css" media="all">
  <link rel="stylesheet" href="/static/css/style.css" media="all">
  <link rel="stylesheet" href="/static/css/pygments.css" media="all">
  <link rel="stylesheet" href="/static/css/font-awesome.css" media="all">

  <!-- atom & rss feed -->
  <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="天松的个人博客 RSS Feed">
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="天松的个人博客 ATOM Feed">
</head>


  <body>
    <div class="container">
      <!--[if lte IE 9]>
<div class="alert alert-warning">
  <p>Your Internet Explorer is not supported. Please upgrade your Internet Explorer to version 9+, or use latest <a href="http://www.google.com/chrome/" target="_blank" class="alert-link">Google chrome</a>、<a href="http://www.mozilla.org/firefox/" target="_blank" class="alert-link">Mozilla Firefox</a>.</p>
  <p>If you are using IE 9 or later, make sure you <a href="http://windows.microsoft.com/en-us/internet-explorer/use-compatibility-view#ie=ie-8" target="_blank" class="alert-link">turn off "Compatibility view"</a>.</p>
</div>
<![endif]-->
<header class="header">
  <div class="title"><a title="天松的个人博客" href="/">天松的个人博客</a></div>
  <ul class="nav navbar-nav navbar-right visible-lg visible-md">
    <li>
    <form id="search-form" class="form-group has-success visible-lg" role="form">
      <input type="text" class="form-control input-sm" placeholder="Search" id="query" style="width: 160px;">
    </form>
    </li>
    <li><a href="/archive.html" title="Archive"><span class='fa fa-archive fa-2x'></span></a></li>
    <li><a href="/categories.html" title="Categories"><span class='fa fa-navicon fa-2x'></span></a></li>
    <li><a href="/tags.html" title="Tags"><span class='fa fa-tags fa-2x'></span></a></li>
    <li><a href="/about.html" title="About"><span class='fa fa-user fa-2x'></span></a></li>
    
    <li><a href="https://github.com/xiatiansong" target="_blank" title="Github"><span class='fa fa-github fa-2x'></span></a></li>
    
    
    
    
    
    <li><a href="http://weibo.com/xiaotian120" target="_blank" title="Weibo"><span class="fa fa-weibo fa-2x"></span></a></li>
    

    <li><a href="/rss.xml" target="_blank" title="RSS"><span class='fa fa-rss fa-2x'></span></a></li>
  </ul>
</header>


      <div class="wrapper">
        <div class="row">
          <div id="search-loader" style="display:none;text-align:center">
            <img src="http://javachen-rs.qiniudn.com/images/loading.gif">
          </div>
          <div class="col-md-12">
  <article class="news-item">

      <h2  class="news-item"> Django中的模板  
        <time class="small">2014.10.30</time>
      </h2>

      <div><p>通过《<a href="/2014/01/11/how-to-create-a-django-site/">如何创建一个Django网站</a>》大概清楚了如何创建一个简单的 Django 网站，这篇文章主要是在此基础上介绍 Django 中模板相关的用法。</p>

<h1 id="视图中使用模板">视图中使用模板</h1>

<p>在《<a href="/2014/01/11/how-to-create-a-django-site/">如何创建一个Django网站</a>》中使用模板的方式如下：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">def</span> <span class="nf">current_datetime</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html&gt;&lt;body&gt;It is now </span><span class="si">%s</span><span class="s">.&lt;/body&gt;&lt;/html&gt;&quot;</span> <span class="o">%</span> <span class="n">now</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</code></pre></div>
<p>可以修改为使用 Django 模板系统：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Template</span><span class="p">,</span> <span class="n">Context</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">def</span> <span class="nf">current_datetime</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;&lt;html&gt;&lt;body&gt;It is now .&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;current_date&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">}))</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</code></pre></div>
<p>还可以将模板内容保存到一个文件中，这需要使用 Django 模板加载的技巧。</p>

<h2 id="模板加载">模板加载</h2>

<p>首先，配置模板目录，编辑 settings.py 文件：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c"># Put strings here, like &quot;/home/html/django_templates&quot; or &quot;C:/www/django/templates&quot;.</span>
    <span class="c"># Always use forward slashes, even on Windows.</span>
    <span class="c"># Don&#39;t forget to use absolute paths, not relative paths.</span>
    <span class="s">&#39;/home/django/mysite/templates&#39;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>上面配置的是系统绝对路径，最好的方式是使用代码动态构建这个路径，例如：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>

<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

<span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span><span class="s">&#39;templates&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;/&#39;</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<blockquote>
<p>这个例子使用了神奇的 Python 内部变量 <code class="prettyprint">__file__</code> ，该变量被自动设置为代码所在的 Python 模块文件名。 <code class="prettyprint">os.path.dirname(__file__)</code>将会获取自身所在的文件，然后由 <code class="prettyprint">os.path.join</code> 这个方法将这目录与 templates 进行连接。如果在 windows下，它会智能地选择正确的后向斜杠&#39;/&#39;进行连接，而不是前向斜杠&#39;/&#39;。</p>
</blockquote>

<p>完成 <code class="prettyprint">TEMPLATE_DIRS</code> 设置后，下一步就是修改视图代码，让它使用 Django 模板加载功能而不是对模板路径硬编码。 返回 current_datetime 视图，进行如下修改：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">get_template</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Context</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">def</span> <span class="nf">current_datetime</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">get_template</span><span class="p">(</span><span class="s">&#39;current_datetime.html&#39;</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;current_date&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">}))</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</code></pre></div>
<p>一种更加简洁的编码方式是使用 <code class="prettyprint">render_to_response()</code>：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">def</span> <span class="nf">current_datetime</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;current_datetime.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;current_date&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">})</span>
</code></pre></div>
<p>上面两个方法都会传入 Context 上下文，将页面需要的变量传到前台去，如果变量很多，需要一一输入。还有一种更加简单的方式，那就是可以利用 Python 的内建函数 <code class="prettyprint">locals()</code> 。它返回的字典对所有局部变量的名称与值进行映射。 因此，前面的视图可以重写成下面这个样子：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">current_datetime</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;current_datetime.html&#39;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>
</code></pre></div>
<p>使用 <code class="prettyprint">locals()</code> 时要注意是它将包括 所有 的局部变量，它们可能比你想让模板访问的要多。 在前例中，<code class="prettyprint">locals()</code> 还包含了 request。</p>

<h1 id="模板标签">模板标签</h1>

<p>上面的例子中提到了模板 <code class="prettyprint">current_datetime.html</code> ，其中的内容如何定义呢？这个就要使用模板标签了。Django 的模板系统带有内置的标签和过滤器。</p>

<h2 id="if/else">if/else</h2>

<p>if 标签检查一个变量，如果这个变量为真（即，变量存在，非空，不是布尔值假），系统会显示在 if 和 endif 之间的任何内容，例如：</p>

<div class="highlight"><pre><code class="html">{% if today_is_weekend %}
    <span class="nt">&lt;p&gt;</span>Welcome to the weekend<span class="nt">&lt;/p&gt;</span>
{% endif %}</code></pre></div>

<p>else 标签是可选的：</p>

<div class="highlight"><pre><code class="html">{% if today_is_weekend %}
    <span class="nt">&lt;p&gt;</span>Welcome to the weekend<span class="nt">&lt;/p&gt;</span>
{% else %}
    <span class="nt">&lt;p&gt;</span>Get back to work.<span class="nt">&lt;/p&gt;</span>
{% endif %}</code></pre></div>

<p>一些注意事项：</p>

<blockquote>
<ol>
<li><p>if 标签接受 and ，or 或者 not 关键字来对多个变量做判断，或者对变量取反。</p></li>
<li><p>if 标签不允许在同一个标签中同时使用 and 和 or ，因为逻辑上可能模糊的。</p></li>
<li><p>系统不支持用圆括号来组合比较操作。</p></li>
<li><p>多次使用同一个逻辑操作符是没有问题的，但是我们不能把不同的操作符组合起来。</p></li>
<li><p>并没有 elif 标签， 请使用嵌套的 if 标签来达成同样的效果。</p></li>
<li><p>一定要用 endif 关闭每一个 if 标签。</p></li>
</ol>
</blockquote>

<h2 id="for">for</h2>

<p>允许我们在一个序列上迭代。 与 Python 的 for 语句的情形类似，循环语法是 <code class="prettyprint">for X in Y</code>，Y 是要迭代的序列而X是在每一个特定的循环中使用的变量名称。 每一次循环中，模板系统会渲染在 for 和 endfor 之间的所有内容。</p>

<p>给定一个运动员列表 <code class="prettyprint">athlete_list</code> 变量，我们可以使用下面的代码来显示这个列表：</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;ul&gt;</span>
{% for athlete in athlete_list %}
    <span class="nt">&lt;li&gt;</span>{{ athlete.name }}<span class="nt">&lt;/li&gt;</span>
{% endfor %}
<span class="nt">&lt;/ul&gt;</span></code></pre></div>

<p>给标签增加一个 <code class="prettyprint">reversed</code> 使得该列表被反向迭代：</p>

<div class="highlight"><pre><code class="html">{% for athlete in athlete_list reversed %}
        <span class="nt">&lt;li&gt;</span>{{ athlete.name }}<span class="nt">&lt;/li&gt;</span>
{% endfor %}</code></pre></div>

<p>在执行循环之前先检测列表的大小是一个通常的做法，当列表为空时输出一些特别的提示。</p>

<div class="highlight"><pre><code class="html">{% if athlete_list %}
    {% for athlete in athlete_list %}
        <span class="nt">&lt;p&gt;</span>{{ athlete.name }}<span class="nt">&lt;/p&gt;</span>
    {% endfor %}
{% else %}
    <span class="nt">&lt;p&gt;</span>There are no athletes. Only computer programmers.<span class="nt">&lt;/p&gt;</span>
{% endif %}</code></pre></div>

<p>因为这种做法十分常见，所以 <code class="prettyprint">for</code> 标签支持一个可选的 empty 分句，通过它我们可以定义当列表为空时的输出内容 下面的例子与之前那个等价：</p>

<div class="highlight"><pre><code class="html">{% for athlete in athlete_list %}
    <span class="nt">&lt;p&gt;</span>{{ athlete.name }}<span class="nt">&lt;/p&gt;</span>
{% empty %}
    <span class="nt">&lt;p&gt;</span>There are no athletes. Only computer programmers.<span class="nt">&lt;/p&gt;</span>
{% endfor %}</code></pre></div>

<p>Django不支持退出循环操作。</p>

<p>在每个 for 循环里有一个称为<code class="prettyprint">forloop</code> 的模板变量。这个变量有一些提示循环进度信息的属性。</p>

<blockquote>
<p>forloop.counter 总是一个表示当前循环的执行次数的整数计数器。 这个计数器是从1开始的，所以在第一次循环时 forloop.counter 将会被设置为1。</p>
</blockquote>

<div class="highlight"><pre><code class="html">{% for item in todo_list %}
    <span class="nt">&lt;p&gt;</span>{{ forloop.counter }}: {{ item }}<span class="nt">&lt;/p&gt;</span>
{% endfor %}</code></pre></div>

<blockquote>
<p>forloop.counter0 类似于 forloop.counter ，但是它是从0计数的。 第一次执行循环时这个变量会被设置为0。</p>

<p>forloop.revcounter 是表示循环中剩余项的整型变量。 在循环初次执行时 forloop.revcounter 将被设置为序列中项的总数。 最后一次循环执行中，这个变量将被置1。</p>

<p>forloop.revcounter0 类似于 forloop.revcounter ，但它以0做为结束索引。 在第一次执行循环时，该变量会被置为序列的项的个数减1。</p>

<p>forloop.first 是一个布尔值，如果该迭代是第一次执行，那么它被置为 True</p>

<p>forloop.last 是一个布尔值；在最后一次执行循环时被置为True</p>

<p>forloop.parentloop 是一个指向当前循环的上一级循环的 forloop 对象的引用（在嵌套循环的情况下）</p>
</blockquote>

<h2 id="ifequal/ifnotequal">ifequal/ifnotequal</h2>

<p>ifequal 标签比较两个值，当他们相等时，显示在 ifequal 和 endifequal 之中所有的值。参数可以是硬编码的字符串，随便用单引号或者双引号引起来。</p>

<div class="highlight"><pre><code class="html">{% ifequal user currentuser %}
    <span class="nt">&lt;h1&gt;</span>Welcome<span class="nt">&lt;/h1&gt;</span>
{% endifequal %}

{% ifequal section &quot;community&quot; %}
    <span class="nt">&lt;h1&gt;</span>Community<span class="nt">&lt;/h1&gt;</span>
{% endifequal %}</code></pre></div>

<p>和 if 类似，ifequal 支持可选的 else 标签。</p>

<p>只有模板变量、字符串、整数和小数可以作为 ifequal 标签的参数。</p>

<h2 id="cycle">cycle</h2>

<p>每当我们使用一次这个标签后，标签中的值就会变化，如上，每使用一次下面的 cycle 标签，输出的就会在 row1 和 row2 之间切换。</p>

<div class="highlight"><pre><code class="html">{% for o in some_list %}  
    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">&quot;{% cycle &#39;row1&#39; &#39;row2&#39; %}&quot;</span><span class="nt">&gt;</span>  
        ...  
    <span class="nt">&lt;/tr&gt;</span>  
{% endfor %}</code></pre></div>

<p>一些情况下，我们希望将cycle当做一个变量一样来使用，那么我们可以这样：</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;tr&gt;</span>  
    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;{% cycle &#39;row1&#39; &#39;row2&#39; as rowcolors %}&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/td&gt;</span>  
    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;{{ rowcolors }}&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/td&gt;</span>  
<span class="nt">&lt;/tr&gt;</span>  
<span class="nt">&lt;tr&gt;</span>  
    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;{% cycle rowcolors %}&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/td&gt;</span>  
    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;{{ rowcolors }}&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/td&gt;</span>  
<span class="nt">&lt;/tr&gt;</span></code></pre></div>

<p>最后，当出现我们不希望 cycle 主动输出的时候，也就是我么只希望它作为一个变量的时候，我们可以这样设置。</p>

<div class="highlight"><pre><code class="python"><span class="p">{</span><span class="o">%</span> <span class="n">cycle</span> <span class="s">&#39;row1&#39;</span> <span class="s">&#39;row2&#39;</span> <span class="k">as</span> <span class="n">rowcolors</span> <span class="n">silent</span> <span class="o">%</span><span class="p">}</span></code></pre></div>

<h2 id="url">url</h2>

<p>Django 中的 url 标签是用来简化 url 的定义，其可以通过唯一的名称引用 urls.py 中定义的 url。</p>

<p>例如：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>    
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^hello/$&#39;</span><span class="p">,</span> <span class="n">hello</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;hello&#39;</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<p>对于上面的定义，可以在模板里通过 hello 名称来应用 <code class="prettyprint">hello/</code> 这个 url。</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{% url &#39;hello&#39; %}&quot;</span><span class="nt">&gt;</span>Hello World<span class="nt">&lt;/a&gt;</span></code></pre></div>

<p>这样使用的好处是，无论你怎么修改 urlpatterns 的地址，Template 都会随着改变，省事了不少。<strong>在模版中调用url标签的时候，需要添加下面代码：</strong></p>

<div class="highlight"><pre><code class="python"><span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">url</span> <span class="kn">from</span> <span class="nn">future</span> <span class="o">%</span><span class="p">}</span></code></pre></div>

<p>需要注意的是：name是全局的，你整个 urlpatterns 里只能一个唯一的name。</p>

<p>如果想在试图中使用该名称，可以使用项目代码（关键在于 <code class="prettyprint">reverse</code> 函数）：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>

<span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&quot;news_index&quot;</span><span class="p">))</span>
</code></pre></div>
<p>当遇到urlpatterns的地址包含有参数的时候，如：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">(</span><span class="s">r&#39;^(?P&lt;year&gt;\d{4})/(?P&lt;month&gt;\d{1,2})/$&#39;</span><span class="p">,</span><span class="s">&#39;news_list&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;news_archive&#39;</span> <span class="p">),</span>
</code></pre></div>
<p>有两个参数，最终的地址如归档的地址 <a href="http://blog.javachen.com/2014/10">http://blog.javachen.com/2014/10</a> ，这时候的标签使用如下：</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{%url &#39;news_archive&#39; 2014  10%}&quot;</span><span class="nt">&gt;</span>2014年10月<span class="nt">&lt;/a&gt;</span> 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{%url &#39;news_archive&#39; year=2014  month=10%}&quot;</span><span class="nt">&gt;</span>2014年10月<span class="nt">&lt;/a&gt;</span></code></pre></div>

<p>当然，在你后台的 views.py 中的方法上也必须有这两个参数。</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">news_list</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;year:&#39;</span><span class="p">,</span><span class="n">year</span>
    <span class="k">print</span> <span class="s">&#39;monty:&#39;</span><span class="p">,</span><span class="n">month</span>
</code></pre></div>
<p>而在试图里写法如下：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="o">......</span>
<span class="n">reverse</span><span class="p">(</span><span class="s">&quot;news_archive&quot;</span><span class="p">,</span><span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;year&quot;</span><span class="p">:</span><span class="mi">2014</span><span class="p">,</span><span class="s">&quot;month&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">})</span>
</code></pre></div>
<h2 id="autoescape">autoescape</h2>

<p>控制HTML转义，参数是：on 或 off。效果和使用 safe 或 escape 过滤器相同。</p>

<div class="highlight"><pre><code class="python"><span class="p">{</span><span class="o">%</span> <span class="n">autoescape</span> <span class="n">on</span> <span class="o">%</span><span class="p">}</span>
    <span class="p">{{</span> <span class="n">body</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endautoescape</span> <span class="o">%</span><span class="p">}</span></code></pre></div>

<h2 id="csrf_token">csrf_token</h2>

<p>防止跨站请求伪造。</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;.&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>{% csrf_token %}</code></pre></div>

<h2 id="debug">debug</h2>

<p>输出完整的调试信息，包括当前的上下文及导入的模块信息。</p>

<h2 id="filter">filter</h2>

<p>通过可变过滤器过滤变量的内容。</p>

<p>过滤器也可以相互传输，它们也可以有参数，就像变量的语法一样。</p>

<p>例：</p>

<div class="highlight"><pre><code class="python"><span class="p">{</span><span class="o">%</span> <span class="nb">filter</span> <span class="n">force_escape</span><span class="o">|</span><span class="n">lower</span> <span class="o">%</span><span class="p">}</span>
    <span class="n">This</span> <span class="n">text</span> <span class="n">will</span> <span class="n">be</span> <span class="n">HTML</span><span class="o">-</span><span class="n">escaped</span><span class="p">,</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">appear</span> <span class="ow">in</span> <span class="nb">all</span> <span class="n">lowercase</span><span class="o">.</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfilter</span> <span class="o">%</span><span class="p">}</span></code></pre></div>

<blockquote>
<p>注意： <br>
escape 和safe 过滤器不能接受参数，而使用 autoescape 标签用来管理模板代码块的自动转移。</p>
</blockquote>

<h2 id="firstof">firstof</h2>

<p>输出传入的第一个不是 False 的变量，如果被传递变量都是 False ，则什么也不输出。例：</p>

<div class="highlight"><pre><code class="python"><span class="p">{</span><span class="o">%</span> <span class="n">firstof</span> <span class="n">var1</span> <span class="n">var2</span> <span class="n">var3</span> <span class="o">%</span><span class="p">}</span></code></pre></div>

<p>等价于:</p>

<div class="highlight"><pre><code class="python"><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">var1</span> <span class="o">%</span><span class="p">}</span>
    <span class="p">{{</span> <span class="n">var1</span><span class="o">|</span><span class="n">safe</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="k">if</span> <span class="n">var2</span> <span class="o">%</span><span class="p">}</span>
    <span class="p">{{</span> <span class="n">var2</span><span class="o">|</span><span class="n">safe</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="k">if</span> <span class="n">var3</span> <span class="o">%</span><span class="p">}</span>
    <span class="p">{{</span> <span class="n">var3</span><span class="o">|</span><span class="n">safe</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span></code></pre></div>

<h2 id="extends">extends</h2>

<p>extends 标签声明这个模板继承的父模板。</p>

<p>例如：</p>

<div class="highlight"><pre><code class="html">{% extends &quot;base.html&quot; %}
{% load staticfiles %}

{% block css %} 
{{ block.super }}
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;css/page/index.css&#39; %}&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">/&gt;</span>
{% endblock %}

{% block content %}
<span class="nt">&lt;p&gt;</span>Hello world<span class="nt">&lt;/p&gt;</span>
{% include &quot;partial/index/product_list.html&quot; %}
{% endblock %}</code></pre></div>

<p>上面代码中，首先用extends标签声明这个模板继承的父模板（必须保证其为模板中的第一个模板标记）。接着重定义 css 这个 block，在包含了父模板的基础上（block.super）引入了新的 CSS 文件；替换了 content 这个 block。这就是子模板所做的全部工作。</p>

<h2 id="block">block</h2>

<p>所有的 block 标签告诉模板引擎，子模板可以重载这些部分，如果子模板不重载这些部分，则将按默认的内容显示。例如：</p>

<div class="highlight"><pre><code class="html">{% load staticfiles %}
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>
        {% block title %} The Default Title {% endblock %}
    <span class="nt">&lt;/title&gt;</span>

    {% block css %} 
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;css/base.css&#39; %}&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">/&gt;</span>
    {% endblock %}
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
        {% block header %}
        {% include &#39;partial/header.html&#39; %}
        {% endblock %}

        {% block content %} {% endblock %}

        {% block footer %}
        {% include &#39;partial/footer.html&#39; %}
        {% endblock %}
    <span class="nt">&lt;/div&gt;</span>

    {% block js %} 
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;{% static &#39;js/jquery.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    {% endblock %}
<span class="nt">&lt;/body&gt;</span></code></pre></div>

<p>顺便提一下，模板中的 <code class="prettyprint">load staticfiles</code> 表示加载静态资源，这个一般用于加载 CSS、JS 等静态文件时用到</p>

<h2 id="include">include</h2>

<p>该标签允许在（模板中）包含其它的模板的内容。标签的参数是所要包含的模板名称，可以是一个变量，也可以是用单/双引号硬编码的字符串。每当在多个模板中出现相同的代码时，就应该考虑是否要使用 <code class="prettyprint">include</code> 来减少重复，这也是为了提高代码的可重用性。</p>

<h2 id="注释">注释</h2>

<p>注释使用：</p>

<div class="highlight"><pre><code class="python"><span class="p">{</span><span class="c"># This is a comment #}</span></code></pre></div>

<p>如果要实现多行注释，可以使用 comment 模板标签。</p>

<h1 id="过滤器">过滤器</h1>

<p>模板过滤器是在变量被显示前修改它的值的一个简单方法，过滤器使用管道字符，例如：</p>

<div class="highlight"><pre><code class="python"><span class="p">{{</span> <span class="n">name</span><span class="o">|</span><span class="n">lower</span> <span class="p">}}</span></code></pre></div>

<p>显示的内容是变量  被过滤器 lower 处理后的结果，它功能是转换文本为小写。</p>

<p>过滤管道可以 <em>套接</em> ：</p>

<div class="highlight"><pre><code class="python"><span class="p">{{</span> <span class="n">my_list</span><span class="o">|</span><span class="n">first</span><span class="o">|</span><span class="n">upper</span> <span class="p">}}</span></code></pre></div>

<p>有些过滤器有参数。 过滤器的参数跟随冒号之后并且总是以双引号包含。 例如：</p>

<div class="highlight"><pre><code class="python"><span class="p">{{</span> <span class="n">bio</span><span class="o">|</span><span class="n">truncatewords</span><span class="p">:</span><span class="s">&quot;30&quot;</span> <span class="p">}}</span></code></pre></div>

<p>这个将显示变量 bio 的前30个词。</p>

<p>当我们使用了网页编辑器的时候，我们通过编辑器得到的是一串 HTML 代码，如果字节输出，那么 django 会将它默认输出为字符串，从而不能显示出样式。这时候，我们可以使用过滤器来实现我们想要的。</p>

<div class="highlight"><pre><code class="python"><span class="p">{{</span><span class="n">myHtml</span><span class="o">|</span><span class="n">safe</span><span class="p">}}</span></code></pre></div>

<p>这样，我们的字符串就被当做 HTML 代码来输出了。safe 表示这段代码是安全的。</p>

<p>一些常见的过滤器：</p>

<ul>
<li><p>addslashes：添加反斜杠到任何反斜杠、单引号或者双引号前面。 这在处理包含 JavaScript 的文本时是非常有用的。</p></li>
<li><p>date：按指定的格式字符串参数格式化 date 或者 datetime 对象，范例：</p></li>
</ul>

<div class="highlight"><pre><code class="python"><span class="p">{{</span> <span class="n">pub_date</span><span class="o">|</span><span class="n">date</span><span class="p">:</span><span class="s">&quot;F j, Y&quot;</span> <span class="p">}}</span></code></pre></div>

<h1 id="参考文章">参考文章</h1>

<ul>
<li><a href="http://djangobook.py3k.cn/2.0/chapter04/">The Django Book-第四章 模板</a></li>
<li><a href="http://www.yihaomen.com/article/python/355.htm">Django url 标签的使用</a></li>
<li><a href="http://raytaylorlin.com/Tech/Script/Python/django-note-3/">Django学习笔记（3）——Django的模板</a></li>
</ul>
</div>

      <!--
      <div id="pay" style="text-align:center;">
        ----EOF-----
        <br>
        <section>
  <h4>Sponsor</h4>
	<img src="http://javachen-rs.qiniudn.com/images/alipay.png" width="150/">
  <p class="small">觉得此博客对你有帮助，支付宝扫码赞助吧</p>
</section>

      </div>
      -->
      <p class="meta">
      	
            Categories:
      	    
          	<a class="btn btn-default btn-xs" href="/categories.html#python">python</a>
          
      	

      	
            Tags:
      	    
          	<a class="btn btn-default btn-xs" href="/tags.html#python">python</a>
          
          	<a class="btn btn-default btn-xs" href="/tags.html#django">django</a>
          
      	
      </p>
	</article>

	<ul class="pager">
	  
	  <li class="previous"><a class="btn btn-xs" href="/2014/10/24/impala-query-table-tutorial" title="Impala查询功能测试">&larr; Prev</a></li>
	  
	  
	  <li class="next"><a class="btn btn-xs" href="/2014/10/30/install-postgresql-on-mac-using-homebrew" title="Mac上使用homebrew安装PostgreSql">Next &rarr;</a></li>
	  
	</ul>

  
<div id="comments">
  <div class="ds-thread" data-thread-key="/2014/10/30/django-template"  data-title="Django中的模板 - 天松的个人博客"></div>
</div>



</div>

        </div>
      </div>

      <footer class="footer text-center">
  <p>&copy; 2009-2015 <a href="/" target="_blank" title="86后，工作在深圳；Java程序员、Hadoop工程师；主要关注Java、Scala、Hadoop、Kettle、关注大数据处理技术。">天松</a>. With Help from <a href="//jekyllrb.com/" target="_blank" title="Transform your plain text into static websites and blogs.">Jekyll</a> and <a href="//getbootstrap.com/" target="_blank" title="Bootstrap is the most popular HTML, CSS, and JS framework for developing responsive, mobile first projects on the web.">Bootstrap</a>, theme from <a href="http://havee.me/" target="_blank" title="http://havee.me/">Havee</a>.

  <span style="float:right;"><a href="/about.html">About</a></span>

	
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254098866'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/z_stat.php%3Fid%3D1254098866' type='text/javascript'%3E%3C/script%3E"));</script>




  </p>
  <div id="toTop" style="display: block;">
    <a href="#">▲</a><a href="#footer">▼</a>
  </div>
</footer>

    </div>

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/core.js"></script>

    
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254098866'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/z_stat.php%3Fid%3D1254098866' type='text/javascript'%3E%3C/script%3E"));</script>




    
    <!-- duoshuo Begin -->
    <script type="text/javascript">
      var duoshuoQuery = {short_name:"xiaotian120"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = 'http://static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] ||
        document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script>
    <!-- duoshuo End -->
    
  </body>
</html>
